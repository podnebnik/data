<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3 ex 1</title>
    <script src="/d3.v4.min.js"></script>
</head>
<body>

<div id="chart"></div>

<script>
    function chart_data(input_data, max_km) {
        var data = [];
        for (i in input_data) {
            v = input_data[i];
            // console.log("i", i, v);
            data.push([
                [0, v[0]/1000., v[2], v[3]],
                [max_km, (v[1] * max_km / 1000. + v[0]) / 1000., v[2], v[3]],
            ]);
        }
        return data;
    }

    var color = d3.scaleOrdinal()
            .domain(["ev", "ice"])
            .range(["steelblue", "orange"]);

    var max_km = 200000;
    var chart_width = 600;
    var chart_height = 300;

    var padding = {
        top: 20,
        bottom: 50,
        left: 70,
        right: 30
    };

    /*
    var input_data = [
        [4526, 58.2, "Volkwagen ID.3 Pro", "ev"],
        [0, 96, "Renault Clio E-Tech 2020", "ice"],
    ];
    */

    var input_data = [
        [2920, 57.5, "Nissan Leaf", "ev"],
        [0, 157, "Ford Fusion 1.6 2007", "ice"],
    ];

    var data1 = chart_data(input_data, max_km);
    console.log("data", data1);

    // chart area
    var chart = d3.select("#chart")
                .append("svg")
                .attr("width", chart_width)
                .attr("height", chart_height)
                .style("border", "1px solid black");

    // x axis
    var x_axis = d3.scaleLinear()
                .domain([0, max_km])
                .range([padding.left, chart_width-padding.right]);

    var x_axis_g = chart.append("g")
        .attr("transform", "translate(0, " + (chart_height - padding.bottom) + ")");

    // x axis title
    chart.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 5)
        .attr("x", 0 - (chart_height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Emisije [ton CO₂]");

    // y axis
    var y_axis = d3.scaleLinear()
                .domain([0, d3.max(data1, function (d) { return d[1]})[1]])
                .range([chart_height - padding.bottom, padding.top]);
    
    var y_axis_g = chart.append("g")
        .attr("transform", "translate(" + padding.left + ",0)");

    // x axis title
    chart.append("text")
        .attr("y", (chart_height) - padding.top - 10)
        .attr("x", (chart_width / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Prevoženih kilometrov");

    var lines = chart.selectAll(".line")
                    .data(data1)
                    .enter()
                    .append("path")
                    .attr("class", "line");

    // lines
    function update_chart(data) {
        x_axis_g.call(d3.axisBottom(x_axis));
        y_axis.domain([0, d3.max(data, function (d) { return d[1]})[1]]);
        y_axis_g.transition().call(d3.axisLeft(y_axis));

        lines.data(data)
            .attr("fill", "none")
            .attr("class", "line")
            .attr("stroke", function(d) {
                return color(d[0][3]); 
            })
            .attr("stroke-width", 1.5)
            .attr("d", function (d) {
                return d3.line()
                    .x(function (d) { 
                        return x_axis(d[0]);
                    })
                    .y(function (d) { 
                        return y_axis(d[1]);
                    })
                    (d)
                }
            );


    }

    update_chart(data1);

    var input_data2 = [
        [4526, 58.2, "Volkwagen ID.3 Pro", "ev"],
        [0, 96, "Renault Clio E-Tech 2020", "ice"],
    ];

    var data2 = chart_data(input_data2, max_km);
    console.log("data2", data2);

    setTimeout(function () {
        update_chart(data2);
    }, 3000);

</script>
</body>
</html>